"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[196],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294),r=n(6010);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,i),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(7462),r=n(7294),o=n(6010),i=n(2466),s=n(6550),l=n(1980),c=n(7392),p=n(12);function u(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function d(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??u(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=d(e),[i,s]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[l,c]=h({queryString:n,groupId:a}),[u,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,p.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),v=(()=>{const e=l??u;return m({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{v&&s(v)}),[v]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);s(e),c(e),g(e)}),[c,g,o]),tabValues:o}}var v=n(2389);const f="tabList__CuJ",y="tabItem_LNqP";function k(e){let{className:t,block:n,selectedValue:s,selectValue:l,tabValues:c}=e;const p=[],{blockElementScrollPositionUntilNextRender:u}=(0,i.o5)(),d=e=>{const t=e.currentTarget,n=p.indexOf(t),a=c[n].value;a!==s&&(u(t),l(a))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>p.push(e),onKeyDown:m,onClick:d},i,{className:(0,o.Z)("tabs__item",y,i?.className,{"tabs__item--active":s===t})}),n??t)})))}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function N(e){const t=g(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",f)},r.createElement(k,(0,a.Z)({},e,t)),r.createElement(b,(0,a.Z)({},e,t)))}function w(e){const t=(0,v.Z)();return r.createElement(N,(0,a.Z)({key:String(t)},e))}},8243:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var a=n(7462),r=(n(7294),n(3905)),o=n(4866),i=n(5162);const s={},l="Validation",c={unversionedId:"diagnostics/validation",id:"diagnostics/validation",title:"Validation",description:"Stashbox validation routines help you detect and solve common misconfiguration issues. You can verify the container's actual state with its .Validate() method. It walks through the whole resolution tree and collects all issues into an AggregateException.",source:"@site/docs/diagnostics/validation.md",sourceDirName:"diagnostics",slug:"/diagnostics/validation",permalink:"/stashbox/docs/diagnostics/validation",draft:!1,editUrl:"https://github.com/z4kn4fein/stashbox/edit/master/docs/docs/diagnostics/validation.md",tags:[],version:"current",lastUpdatedBy:"dependabot[bot]",lastUpdatedAt:1685963733,formattedLastUpdatedAt:"Jun 5, 2023",frontMatter:{},sidebar:"docs",previous:{title:"Special resolution cases",permalink:"/stashbox/docs/advanced/special-resolution-cases"},next:{title:"Utilities",permalink:"/stashbox/docs/diagnostics/utilities"}},p={},u=[{value:"Registration validation",id:"registration-validation",level:2},{value:"InvalidRegistrationException",id:"invalidregistrationexception",level:3},{value:"ServiceAlreadyRegisteredException",id:"servicealreadyregisteredexception",level:3},{value:"Resolution validation",id:"resolution-validation",level:2},{value:"Lifetime validation",id:"lifetime-validation",level:2},{value:"Circular dependency",id:"circular-dependency",level:2},{value:"Other exceptions",id:"other-exceptions",level:2},{value:"CompositionRootNotFoundException",id:"compositionrootnotfoundexception",level:3},{value:"ConstructorNotFoundException",id:"constructornotfoundexception",level:3}],d={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"validation"},"Validation"),(0,r.kt)("p",null,"Stashbox validation routines help you detect and solve common misconfiguration issues. You can verify the container's actual state with its ",(0,r.kt)("inlineCode",{parentName:"p"},".Validate()")," method. It walks through the whole ",(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/glossary#resolution-tree"},"resolution tree")," and collects all issues into an ",(0,r.kt)("inlineCode",{parentName:"p"},"AggregateException"),"."),(0,r.kt)("h2",{id:"registration-validation"},"Registration validation"),(0,r.kt)("p",null,"During registration, the container validates the passed types and throws the following exceptions when the validation fails."),(0,r.kt)("h3",{id:"invalidregistrationexception"},"InvalidRegistrationException"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"When the ",(0,r.kt)("a",{parentName:"strong",href:"/docs/getting-started/glossary#service-type--implementation-type"},"implementation type")," is not resolvable.")," (it's an interface or an abstract class registered like: ",(0,r.kt)("inlineCode",{parentName:"li"},"Register<IService>()"),"):",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"The type Namespace.IService could not be resolved. It's probably an interface, abstract class, or primitive type.\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"When the ",(0,r.kt)("a",{parentName:"strong",href:"/docs/getting-started/glossary#service-type--implementation-type"},"implementation type")," does not implement the ",(0,r.kt)("a",{parentName:"strong",href:"/docs/getting-started/glossary#service-type--implementation-type"},"service type")),".",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"The type Namespace.MotorCycle does not implement the '[service type](/docs/getting-started/glossary#service-type--implementation-type)' Namespace.ICar.\n")))),(0,r.kt)("h3",{id:"servicealreadyregisteredexception"},"ServiceAlreadyRegisteredException"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"When the given ",(0,r.kt)("a",{parentName:"strong",href:"/docs/getting-started/glossary#service-type--implementation-type"},"implementation type")," is already registered")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"RegistrationBehavior")," ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/container-configuration#registration-behavior"},"container configuration option")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"ThrowException"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"The type Namespace.Service is already registered.\n")),(0,r.kt)("h2",{id:"resolution-validation"},"Resolution validation"),(0,r.kt)("p",null,"During the ",(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/glossary#resolution-tree"},"resolution tree's")," construction, the container continuously checks its actual state to ensure stability. When any of the following issues occur, the container throws a ",(0,r.kt)("inlineCode",{parentName:"p"},"ResolutionFailedException"),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"When a dependency is missing from the ",(0,r.kt)("a",{parentName:"strong",href:"/docs/getting-started/glossary#resolution-tree"},"resolution tree")),"."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"Parameter",label:"Parameter",mdxType:"TabItem"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"class Service\n{\n    public Service(Dependency dep) { }\n\n    public Service(Dependency2 dep2) { }\n}\n\ncontainer.Register<Service>();\nvar service = container.Resolve<Service>();\n")),(0,r.kt)("p",{parentName:"li"},"This will result in the following exception message:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"Could not resolve type Namespace.Service.\nConstructor Void .ctor(Dependency) found with unresolvable parameter: (Namespace.Dependency)dep.\nConstructor Void .ctor(Dependency2) found with unresolvable parameter: (Namespace.Dependency2)dep2.\n"))),(0,r.kt)(i.Z,{value:"Property / field",label:"Property / field",mdxType:"TabItem"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"class Service\n{\n    public Dependency Dep { get; set; }\n}\n\ncontainer.Register<Service>(options => options.WithDependencyBinding(s => s.Dep));\nvar service = container.Resolve<Service>();\n")),(0,r.kt)("p",{parentName:"li"},"This will show the following message:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"Could not resolve type Namespace.Service.\nUnresolvable property: (Namespace.Dependency)Dep.\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"When the requested type is unresolvable.")," E.g., it doesn't have a public constructor."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"Could not resolve type Namespace.Service.\nService is not registered or unresolvable type requested.\n")))),(0,r.kt)("h2",{id:"lifetime-validation"},"Lifetime validation"),(0,r.kt)("p",null,"This validation enforces the following rules. When they are violated, the container throws a ",(0,r.kt)("inlineCode",{parentName:"p"},"LifetimeValidationFailedException"),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"When a scoped service is requested from the ",(0,r.kt)("a",{parentName:"strong",href:"/docs/getting-started/glossary#root-scope"},"root scope")),".",(0,r.kt)("br",{parentName:"p"}),"\n","As the ",(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/glossary#root-scope"},"root scope's")," lifetime is bound to the container's lifetime, this action unintentionally promotes the scoped service's lifetime to singleton:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"Resolution of Namespace.Service (ScopedLifetime) from the '[root scope](/docs/getting-started/glossary#root-scope)' is not allowed, \nthat would promote the service's lifetime to a singleton.\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"When the life-span of a dependency is shorter than its parent's"),".",(0,r.kt)("br",{parentName:"p"}),"\n","It's called ",(0,r.kt)("a",{parentName:"p",href:"https://blog.ploeh.dk/2014/06/02/captive-dependency/"},"captive dependency"),". Every lifetime has a ",(0,r.kt)("inlineCode",{parentName:"p"},"LifeSpan")," value, which determines how long the related service lives. The main rule is that services may not contain dependencies with shorter life spans. E.g., singletons should not depend on scoped services. The only exception is the life span value ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),", which indicates that the related service is state-less and could be injected into any service. "),(0,r.kt)("p",{parentName:"li"}," These are the ",(0,r.kt)("inlineCode",{parentName:"p"},"LifeSpan")," values of the pre-defined lifetimes: "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Singleton"),": 20"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Scoped"),": 10"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"NamedScope"),": 10"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PerRequest"),": 0"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PerScopedRequest"),": 0"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Transient"),": 0")),(0,r.kt)("p",{parentName:"li"},"In case of a failed validation the exception message would be:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"The life-span of Namespace.Service (ScopedLifetime|10) is shorter than \nits direct or indirect parent's Namespace.Dependency (Singleton|20). \nThis could lead to incidental lifetime promotions with longer life-span, \nit's recommended to double-check your lifetime configurations.\n")))),(0,r.kt)("h2",{id:"circular-dependency"},"Circular dependency"),(0,r.kt)("p",null,"When the container encounters a circular dependency loop in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/glossary#resolution-tree"},"resolution tree"),", it throws a ",(0,r.kt)("inlineCode",{parentName:"p"},"CircularDependencyException"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"class Service1\n{\n    public Service1(Service2 service2) { }\n}\n\nclass Service2\n{\n    public Service2(Service1 service1) { }\n}\n\ncontainer.Register<Service1>();\ncontainer.Register<Service2>();\nvar service = container.Resolve<Service1>();\n")),(0,r.kt)("p",null,"The exception message is:  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Circular dependency detected during the resolution of Namespace.Service1.\n")),(0,r.kt)("h2",{id:"other-exceptions"},"Other exceptions"),(0,r.kt)("h3",{id:"compositionrootnotfoundexception"},"CompositionRootNotFoundException"),(0,r.kt)("p",null,"This exception pops up when we try to compose an assembly, but it doesn't contain an ",(0,r.kt)("inlineCode",{parentName:"p"},"ICompositionRoot")," implementation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"container.ComposeAssembly(typeof(Service).Assembly);\n")),(0,r.kt)("p",null,"The exception message is:  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"No ICompositionRoot found in the given assembly: {your-assembly-name}\n")),(0,r.kt)("h3",{id:"constructornotfoundexception"},"ConstructorNotFoundException"),(0,r.kt)("p",null,"During the registration phase, when you are using the ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/registration-configuration#withconstructorbyargumenttypes"},(0,r.kt)("inlineCode",{parentName:"a"},"WithConstructorByArgumentTypes()"))," or ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/registration-configuration#withconstructorbyarguments"},(0,r.kt)("inlineCode",{parentName:"a"},"WithConstructorByArguments()"))," options, you can accidentally point to a non-existing constructor. In that case, the container throws a ",(0,r.kt)("inlineCode",{parentName:"p"},"ConstructorNotFoundException"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"class Service\n{\n    public Service(Dependency dep) { }\n}\n\ncontainer.Register<Service>(options => options.WithConstructorByArgumentTypes(typeof(string), typeof(int)));\n")),(0,r.kt)("p",null,"The exception message is:  "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Constructor not found for Namespace.Service with the given argument types: System.String, System.Int32.\n")))}m.isMDXComponent=!0}}]);